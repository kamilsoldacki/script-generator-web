<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIElevenLabs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-row">
                <div class="header-left">
                    <div class="header-title">IIElevenLabs</div>
                </div>
                {% if auth_enabled %}
                    <a class="header-link" href="/logout">Log out</a>
                {% endif %}
            </div>
        </header>

        <div class="card">
            <h1>Generate a script</h1>
            <p class="card-subtitle">Keep it simple. One voice only. Generate a voiceover script and download it as a .txt.</p>
            <form id="scriptForm">
                <div class="form-group">
                    <label for="script_type">Script type</label>
                    <input
                        id="script_type"
                        name="script_type"
                        type="text"
                        required
                        placeholder="e.g., agent, conversational, explainer, product demo, training"
                    />
                </div>

                <div class="form-group">
                    <label for="language">Language</label>
                    <select id="language" name="language" required>
                        <option value="AFR">AFR — Afrikaans</option>
                        <option value="ARA">ARA — Arabic</option>
                        <option value="HYE">HYE — Armenian</option>
                        <option value="ASM">ASM — Assamese</option>
                        <option value="AZE">AZE — Azerbaijani</option>
                        <option value="BEL">BEL — Belarusian</option>
                        <option value="BEN">BEN — Bengali</option>
                        <option value="BOS">BOS — Bosnian</option>
                        <option value="BUL">BUL — Bulgarian</option>
                        <option value="CAT">CAT — Catalan</option>
                        <option value="CEB">CEB — Cebuano</option>
                        <option value="NYA">NYA — Chichewa</option>
                        <option value="HRV">HRV — Croatian</option>
                        <option value="CES">CES — Czech</option>
                        <option value="DAN">DAN — Danish</option>
                        <option value="NLD">NLD — Dutch</option>
                        <option value="ENG" selected>ENG — English</option>
                        <option value="EST">EST — Estonian</option>
                        <option value="FIL">FIL — Filipino</option>
                        <option value="FIN">FIN — Finnish</option>
                        <option value="FRA">FRA — French</option>
                        <option value="GLG">GLG — Galician</option>
                        <option value="KAT">KAT — Georgian</option>
                        <option value="DEU">DEU — German</option>
                        <option value="ELL">ELL — Greek</option>
                        <option value="GUJ">GUJ — Gujarati</option>
                        <option value="HAU">HAU — Hausa</option>
                        <option value="HEB">HEB — Hebrew</option>
                        <option value="HIN">HIN — Hindi</option>
                        <option value="HUN">HUN — Hungarian</option>
                        <option value="ISL">ISL — Icelandic</option>
                        <option value="IND">IND — Indonesian</option>
                        <option value="GLE">GLE — Irish</option>
                        <option value="ITA">ITA — Italian</option>
                        <option value="JPN">JPN — Japanese</option>
                        <option value="JAV">JAV — Javanese</option>
                        <option value="KAN">KAN — Kannada</option>
                        <option value="KAZ">KAZ — Kazakh</option>
                        <option value="KIR">KIR — Kirghiz</option>
                        <option value="KOR">KOR — Korean</option>
                        <option value="LAV">LAV — Latvian</option>
                        <option value="LIN">LIN — Lingala</option>
                        <option value="LIT">LIT — Lithuanian</option>
                        <option value="LTZ">LTZ — Luxembourgish</option>
                        <option value="MKD">MKD — Macedonian</option>
                        <option value="MSA">MSA — Malay</option>
                        <option value="MAL">MAL — Malayalam</option>
                        <option value="CMN">CMN — Mandarin Chinese</option>
                        <option value="MAR">MAR — Marathi</option>
                        <option value="NEP">NEP — Nepali</option>
                        <option value="NOR">NOR — Norwegian</option>
                        <option value="PUS">PUS — Pashto</option>
                        <option value="FAS">FAS — Persian</option>
                        <option value="POL">POL — Polish</option>
                        <option value="POR">POR — Portuguese</option>
                        <option value="PAN">PAN — Punjabi</option>
                        <option value="RON">RON — Romanian</option>
                        <option value="RUS">RUS — Russian</option>
                        <option value="SRP">SRP — Serbian</option>
                        <option value="SND">SND — Sindhi</option>
                        <option value="SLK">SLK — Slovak</option>
                        <option value="SLV">SLV — Slovenian</option>
                        <option value="SOM">SOM — Somali</option>
                        <option value="SPA">SPA — Spanish</option>
                        <option value="SWA">SWA — Swahili</option>
                        <option value="SWE">SWE — Swedish</option>
                        <option value="TAM">TAM — Tamil</option>
                        <option value="TEL">TEL — Telugu</option>
                        <option value="THA">THA — Thai</option>
                        <option value="TUR">TUR — Turkish</option>
                        <option value="UKR">UKR — Ukrainian</option>
                        <option value="URD">URD — Urdu</option>
                        <option value="VIE">VIE — Vietnamese</option>
                        <option value="CYM">CYM — Welsh</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="accent">Accent / dialect (optional)</label>
                    <input id="accent" name="accent" type="text" placeholder="e.g., neutral, en-GB, South African English..." />
                </div>

                <div class="form-group">
                    <label for="details">Details (optional)</label>
                    <textarea
                        id="details"
                        name="details"
                        rows="8"
                        placeholder="Describe the context, product, tone, audience, structure, must-have points, constraints, and anything important for recording..."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="brief">Brief (optional)</label>
                    <textarea 
                        id="brief" 
                        name="brief" 
                        rows="6"
                        placeholder="Optional: voice/persona, brand, reading rules for numbers, pacing, style constraints..."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="target_minutes">Target length (minutes)</label>
                    <input id="target_minutes" name="target_minutes" type="number" min="1" max="60" step="1" value="5" required />
                    <div class="hint" id="targetWordsHint"></div>
                </div>

                <button type="submit" class="btn-primary" id="generateBtn">
                    Generate
                </button>
            </form>
        </div>

        <div id="resultSection" class="card result-section" style="display: none;">
            <h2>Script ready</h2>
            <div class="meta-row">
                <div class="meta-item" id="estimatedLength"></div>
                <div class="meta-item" id="wordCount"></div>
            </div>
            
            <div class="preview-box">
                <h3>Preview</h3>
                <div id="preview"></div>
            </div>

            <div class="action-buttons">
                <button id="downloadBtn" class="btn-success">
                    Download .txt
                </button>
                <button id="downloadMetaBtn" class="btn-secondary" style="width:100%;">
                    Download metadata (.json)
                </button>
                <button id="newScriptBtn" class="btn-secondary">
                    New script
                </button>
            </div>
        </div>

        <div id="loadingSection" class="loading-section" style="display: none;">
            <div class="spinner"></div>
            <p>Generating...</p>
            <p class="loading-subtext">This can take a few seconds.</p>
        </div>

        <div id="errorSection" class="error-section" style="display: none;">
            <div class="error-box">
                <h3>Error</h3>
                <p id="errorMessage"></p>
                <button id="retryBtn" class="btn-secondary">Try again</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Built with ❤️ for the ElevenLabs team · Kamil Soldacki</p>
    </footer>

    <script>
        let currentFilename = null;
        let currentMetaFilename = null;

        const form = document.getElementById('scriptForm');
        const resultSection = document.getElementById('resultSection');
        const loadingSection = document.getElementById('loadingSection');
        const errorSection = document.getElementById('errorSection');
        const targetMinutesInput = document.getElementById('target_minutes');
        const targetWordsHint = document.getElementById('targetWordsHint');

        function updateTargetWordsHint() {
            const minutes = parseInt(targetMinutesInput.value || '0', 10);
            if (!minutes || minutes < 1) {
                targetWordsHint.textContent = '';
                return;
            }
            const approxWords = Math.round(minutes * 150);
            targetWordsHint.textContent = `We will aim for about ${approxWords} words.`;
        }
        targetMinutesInput.addEventListener('input', updateTargetWordsHint);
        updateTargetWordsHint();

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const scriptTypeEl = document.getElementById('script_type');
            const script_type = scriptTypeEl.value;
            const language = document.getElementById('language').value;
            const accent = document.getElementById('accent').value;
            const details = document.getElementById('details').value;
            const brief = document.getElementById('brief').value;
            const target_minutes = parseInt(document.getElementById('target_minutes').value, 10);

            if (!script_type || !script_type.trim()) {
                document.getElementById('errorMessage').textContent = 'Please enter Script type.';
                loadingSection.style.display = 'none';
                resultSection.style.display = 'none';
                errorSection.style.display = 'block';
                scriptTypeEl.focus();
                return;
            }

            // Show loading
            form.parentElement.style.display = 'none';
            resultSection.style.display = 'none';
            errorSection.style.display = 'none';
            loadingSection.style.display = 'block';

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        script_type,
                        language,
                        accent,
                        details,
                        brief,
                        target_minutes,
                    })
                });

                const rawText = await response.text();
                let data = null;
                try {
                    data = rawText ? JSON.parse(rawText) : {};
                } catch (e) {
                    const snippet = rawText ? rawText.slice(0, 240) : '';
                    throw new Error(`Non-JSON response (${response.status}). ${snippet}`);
                }

                if (response.ok && data.success) {
                    currentFilename = data.filename;
                    currentMetaFilename = data.meta_filename;
                    document.getElementById('preview').textContent = data.preview;
                    document.getElementById('estimatedLength').textContent = data.estimated_minutes ? `Estimated length: ~${data.estimated_minutes} min` : '';
                    document.getElementById('wordCount').textContent = data.word_count ? `Words: ${data.word_count}` : '';
                    
                    loadingSection.style.display = 'none';
                    resultSection.style.display = 'block';
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').textContent = error.message;
                loadingSection.style.display = 'none';
                errorSection.style.display = 'block';
            }
        });

        // Download button
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (currentFilename) {
                window.location.href = `/download/${currentFilename}`;
            }
        });

        // Download meta button
        document.getElementById('downloadMetaBtn').addEventListener('click', () => {
            if (currentMetaFilename) {
                window.location.href = `/download-meta/${currentMetaFilename}`;
            }
        });

        // New script button
        document.getElementById('newScriptBtn').addEventListener('click', () => {
            resultSection.style.display = 'none';
            form.parentElement.style.display = 'block';
            form.reset();
            updateTargetWordsHint();
        });

        // Retry button
        document.getElementById('retryBtn').addEventListener('click', () => {
            errorSection.style.display = 'none';
            form.parentElement.style.display = 'block';
        });
    </script>
</body>
</html>


